---
- name: Machine setup
  hosts: localhost
  #become: true
  connection: local
  gather_facts: true
  vars:
    regular_user: "{{ ansible_env.SUDO_USER or ansible_user }}"
    package_manager:
      Linux_Mint: apt
      MacOS: homebrew
      Raspberry_Pi: apt

  tasks:
  # - name: Get my user
  #   set_fact:
  #     remote_regular_user: "{{ ansible_env.SUDO_USER or ansible_user_id }}"
        
  - name: APT Install common packages for Raspberry Pi and Linux
    when: ansible_distribution == 'Raspberry Pi OS' or ansible_distribution == 'Ubuntu' or ansible_distribution == 'LinuxMint'
    block:
      - name: Install APT packages
        apt:
          name:
            - btop
          state: present

  - name: APT Install common packages for Raspberry Pi and Linux
    when: ansible_distribution == 'Raspberry Pi OS' or ansible_distribution == 'Ubuntu' or ansible_distribution == 'LinuxMint'
    block:
      - name: Install SNAP packages
        community.general.snap:
          name:
            - sublime-text
          state: present

  - name: APT Install common packages for Raspberry Pi and Linux
    when: ansible_distribution == 'Raspberry Pi OS' or ansible_distribution == 'Ubuntu' or ansible_distribution == 'LinuxMint'
    block:
      - name: Install Flatpak packages
        community.general.flatpak:
          name:
            - org.videolan.VLC
            - com.stremio.Stremio
          state: present

  - name: APT Install common packages for Raspberry Pi and Linux
    when: ansible_distribution == 'Raspberry Pi OS' or ansible_distribution == 'Ubuntu' or ansible_distribution == 'LinuxMint'
    block:
      - name: Ensure fonts directory on all systems
        file:
          path: "{{ regular_user.home }}/.fonts"
          state: directory
          mode: "0755"
          owner: "{{ regular_user.name }}"

  # - name: Change shell to zsh
  #   user:
  #     name: "{{ remote_regular_user }}"
  #     shell: /usr/bin/zsh

  # - name: Instalar pacotes usando brew formulae
  #   ansible.builtin.homebrew:
  #     name:
  #       - btop
  #     state: present
  #   when: ansible_distribution == 'MacOSX'

  # - name: Instalar aplicativos usando brew cask
  #   ansible.builtin.homebrew:
  #     name:
  #         - sublime-text
  #     state: present
  #     install_options: "cask"
  #   when: ansible_distribution == 'MacOSX'

# TODO aplicacao para appstore 


    # - name: Install Docker on MacOS
    #   ansible.builtin.when: ansible_distribution == 'MacOSX'
    #   community.general.homebrew:
    #     name:
    #       - docker
    #       - docker-compose
    #     state: present