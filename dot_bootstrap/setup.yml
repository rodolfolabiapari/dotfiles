---
- name: Machine setup
  hosts: localhost
  become: true
  connection: local
  gather_facts: true
  vars:
    regular_user: "{{ ansible_env.SUDO_USER or ansible_user }}"
    package_manager:
      Linux_Mint: apt
      MacOS: homebrew
      Raspberry_Pi: apt

  tasks:
  # - name: Get my user
  #   set_fact:
  #     remote_regular_user: "{{ ansible_env.SUDO_USER or ansible_user_id }}"

  - name: Exibir distribuição do sistema operacional
    debug:
      msg: "A distribuição do sistema operacional é {{ ansible_distribution }}"
      
  - name: Atualizar lista de pacotes
    apt:
      update_cache: yes
        
  - name: APT Install common packages for Raspberry Pi and Linux
    when: ansible_distribution == 'Raspberry Pi OS' or ansible_distribution == 'Ubuntu' or ansible_distribution == 'Linux Mint'
    block:
      - name: Install APT packages
        apt:
          name:
            - ansible
            - awscli
            - bat
            - bc
            - btop
            - curl
            - docker
            - docker-compose
            - flameshot
            - flatpak
            - gcc
            - git
            - google-cloud-cli
            - google-cloud-sdk-gke-gcloud-auth-plugin
            - google-cloud-sdk-terraform-tools
            - gparted
            - gpg
            - graphviz
            - grep
            - htop
            - ipcalc
            - jq
            - less
            - openssl
            - openvpn
            - pciutils
            - perl
            - pwgen
            - ruby-dev
            - sed
            - snap
            - tar
            - telnet
            - terminator
            - tmux
            - traceroute
            - tree
            - ufw
            - unzip
            - vim
            - xclip
            - zip
            - zoxide
            - zsh
            - zsh-syntax-highlighting
          state: present

      - name: Install SNAP packages
        community.general.snap:
          name:
            - bare
            - brave
            - canonical-livepatch
            - chezmoi
            - code
            - docker
            - google-cloud-sdk
            - helm
            - postman
            - rpi-imager
            - spotify
            - sublime-text
            - telegram-desktop
            - zoom-client
          state: present

      - name: Install Flatpak packages
        command:
          cmd: "/usr/bin/flatpak install --system --noninteractive flathub {{ item }}"
        loop: "{{ flatpak_packages }}"
        vars:
          flatpak_packages:
            - 'org.videolan.VLC'
            - 'com.stremio.Stremio'

  # - name: Change shell to zsh
  #   user:
  #     name: "{{ remote_regular_user }}"
  #     shell: /usr/bin/zsh

  # - name: Instalar pacotes usando brew formulae
  #   ansible.builtin.homebrew:
  #     name:
  #       - btop
  #     state: present
  #   when: ansible_distribution == 'MacOSX'

  # - name: Instalar aplicativos usando brew cask
  #   ansible.builtin.homebrew:
  #     name:
  #         - sublime-text
  #     state: present
  #     install_options: "cask"
  #   when: ansible_distribution == 'MacOSX'

# TODO aplicacao para appstore 


    # - name: Install Docker on MacOS
    #   ansible.builtin.when: ansible_distribution == 'MacOSX'
    #   community.general.homebrew:
    #     name:
    #       - docker
    #       - docker-compose
    #     state: present