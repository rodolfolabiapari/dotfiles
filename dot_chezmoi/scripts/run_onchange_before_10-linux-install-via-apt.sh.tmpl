#!/usr/bin/env bash
# -*- mode:bash; tab-with=2; indent-tabs-mode=0; -*-
# vim:ft=bash

{{ if eq .chezmoi.os "linux" }}
set -eufo pipefail

# apt/common.sh hash: {{ include "dot_chezmoi/scripts/parameters/apt/common.sh" | sha256sum }}
# apt/workplace.sh hash: {{ include "dot_chezmoi/scripts/parameters/apt/workplace.sh" | sha256sum }}

# Exibir distribuição do sistema operacional
echo -e "\n\033[0;32mDistro $(lsb_release -ds) of system $(uname -m)\033[0m"

# List of ppa repositories to add
repositories=()

echo -e "\nAPT add new repositories"
# Add Repositories
for repository in ${repositories[@]}; do
  ppa_repo_source=${repository#ppa:}
  if ! $(apt-cache policy | grep http | awk '{print $2}' | sort -u | grep $ppa_repo_source &> /dev/null); then
    echo -e "adding $repository repository to apt"
    add-apt-repository -y $repository
  fi
done

echo -e "\nVerificando e arrumando pacotes quebrados"
sudo dpkg --configure -a
sudo apt --fix-broken install

echo -e "\nAPT Update the list of repositories"
sudo apt update

echo -e "\nAPT Upgrade the already installed packages"
sudo apt upgrade -y

echo -e "\nAPT Install Basics APT packges"
{{ include "dot_chezmoi/scripts/parameters/apt/common.sh" }}

{{ if (eq .chezmoi.arch "amd64") }}
echo -e "\nInstalling Packages for workplace system"
{{ include "dot_chezmoi/scripts/parameters/apt/workplace.sh" }}
{{ end }}

sudo echo -e "\nAutoClean"
sudo apt autoclean

echo -e "\nAutoRemove"
sudo apt autoremove -y
sudo apt clean

echo -e "\n\033[0;32mFinish Setting Up Ubuntu Packages\033[0m"

{{ end }}
